import{calcDaysBetweenDates}from"./util.js";import{updateTotal}from"./services.js";const ACCOMODATION_PRICE=3200,booking=document.querySelector(".booking__form"),totalList=document.querySelector(".total__details"),totalSum=document.querySelector("#final-amount"),buttonLess=document.querySelector("#less-guests"),buttonMore=document.querySelector("#more-guests"),guests=document.querySelector("#guests"),checkinField=document.querySelector("#checkin"),checkoutField=document.querySelector("#checkout"),nightsCountElement=document.querySelector("#nights"),accomodationPriceElement=document.querySelector("#nightsPrice"),bookButton=document.querySelector(".total__submit-button"),loadSavedValues=()=>{if(booking&&(sessionStorage.checkin&&(checkinField.value=sessionStorage.checkin),sessionStorage.checkout&&(checkoutField.value=sessionStorage.checkout),sessionStorage.guests&&(guests.value=sessionStorage.guests),sessionStorage.nights&&(nightsCountElement.textContent=sessionStorage.nights,accomodationPriceElement.textContent=3200*sessionStorage.nights,updateTotal(totalList,totalSum)),sessionStorage.servicesCheckboxes)){const e=sessionStorage.servicesCheckboxes.split(",");document.querySelectorAll(".checkbox-control__input").forEach((t=>{e.includes(t.name)&&(t.checked=!0)}))}},initGuestsButtons=()=>{if(buttonLess&&buttonMore&&guests){let e=+guests.value;e<=1&&(buttonLess.disabled=!0);const t=()=>{buttonMore.disabled=!1,e--,guests.value=e.toString(),1===e&&(buttonLess.disabled=!0)},o=()=>{e++,guests.value=e.toString(),buttonLess.disabled=!1,e>=3&&(buttonMore.disabled=!0)};buttonLess.addEventListener("click",t),buttonMore.addEventListener("click",o)}},initDateSelection=()=>{if(checkinField&&checkoutField&&nightsCountElement&&accomodationPriceElement){const e=()=>{if(checkinField.value&&checkoutField.value){const e=new Date(checkinField.value),t=new Date(checkoutField.value);return e.getTime()<t.getTime()}return!1},t=()=>{if(e()){const e=new Date(checkinField.value),t=new Date(checkoutField.value),o=calcDaysBetweenDates(e,t);nightsCountElement.textContent=o,accomodationPriceElement.textContent=3200*o,updateTotal(totalList,totalSum)}};[checkinField,checkoutField].forEach((e=>e.addEventListener("change",(()=>t()))))}},initBookButton=()=>{if(bookButton){const e=document.querySelectorAll(".checkbox-control__input"),t=()=>{const t=[];return e.forEach((e=>{e.checked&&t.push(e.name)})),t},o=()=>{const e=document.querySelector(".total__element--discount");let t=0;return e&&!e.classList.contains("total__element--hidden")&&(t=e.querySelector("#discount").textContent),t},n=e=>{if(e.preventDefault(),checkinField.value&&checkoutField.value){const n=new Date(checkinField.value),s=new Date(checkoutField.value);n.getTime()<s.getTime()?(sessionStorage.servicesCheckboxes=t(),sessionStorage.discount=o(),sessionStorage.checkin=checkinField.value,sessionStorage.checkout=checkoutField.value,sessionStorage.guests=guests.value,sessionStorage.total=totalSum.textContent,sessionStorage.nights=nightsCountElement.textContent,sessionStorage.accomodation=accomodationPriceElement.textContent,window.location=e.currentTarget.href):alert("You can`t checkout before you check in :) ")}else alert("please select check in and check out dates")};bookButton.addEventListener("click",n)}};export{initGuestsButtons,initDateSelection,initBookButton,loadSavedValues};